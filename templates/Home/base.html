{% load static %} {% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <title>thao.edu</title>
    <link rel="shortcut icon" href="{%static 'assets/img/favicon.png' %}" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,500;0,600;0,700;1,400&amp;display=swap"
    />
    <link
      rel="stylesheet"
      href="{%static 'assets/plugins/bootstrap/css/bootstrap.min.css' %}"
    />
    <link
      rel="stylesheet"
      href="{%static 'assets/plugins/fontawesome/css/fontawesome.min.css' %}"
    />
    <link
      rel="stylesheet"
      href="{%static 'assets/plugins/fontawesome/css/all.min.css' %}"
    />
    <link rel="stylesheet" href="{%static 'assets/css/style.css' %}" />
  </head>
  <body>
    <div class="main-wrapper">
      <div class="header">
        <div class="header-left">
          <a href="{% url 'dashboard' %}" class="logo">
            <img src="{% static 'assets/img/logo.png' %}" alt="Logo" />
          </a>
          <a href="{% url 'dashboard' %}" class="logo logo-small">
            <img
              src="{% static 'assets/img/logo-small.png' %}"
              alt="Logo"
              width="30"
              height="30"
            />
          </a>
        </div>
        <a href="javascript:void(0);" id="toggle_btn">
          <i class="fas fa-align-left"></i>
        </a>
        <div class="top-nav-search">
          <form>
            <input
              type="text"
              class="form-control"
              placeholder="{% trans 'Search here' %}"
            />
            <button class="btn" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </form>
        </div>
        <a class="mobile_btn" id="mobile_btn">
          <i class="fas fa-bars"></i>
        </a>
        <ul class="nav user-menu">
          <li class="nav-item dropdown noti-dropdown">
            <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
              {% if unread_notification_count > 0 %}
              <i class="far fa-bell"></i>
              <span class="badge badge-pill"
                >{{unread_notification_count}}</span
              >
              {% endif %}
            </a>
            <div class="dropdown-menu notifications">
              <div class="topnav-dropdown-header">
                <span class="notification-title"
                  >{% trans "Notifications" %}</span
                >
                <a href="javascript:void(0)" class="clear-noti">
                  {% trans "Clear All" %}
                </a>
              </div>
              <div class="noti-content">
                <ul class="notification-list">
                  {% for notification in unread_notification %}
                  <li class="notification-message">
                    <a href="#">
                      <div class="media">
                        <span class="avatar avatar-sm">
                          <img
                            class="avatar-img rounded-circle"
                            alt="User Image"
                            src="{% static 'assets/img/profiles/avatar-18.jpg' %}"
                          />
                        </span>
                        <div class="media-body">
                          <p class="noti-details">
                            <span class="noti-title"
                              >{{ notification.user.username }}</span
                            >
                            {{ notification.message }}
                            <span class="noti-title">your estimate</span>
                          </p>
                          <p class="noti-time">
                            <span class="notification-time"
                              >{{ notification.created_at|timesince }} ago</span
                            >
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </li>
          <li class="nav-item dropdown has-arrow">
            <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
              <span class="user-img"
                ><img
                  class="rounded-circle"
                  src="{% static 'assets/img/profiles/avatar-18.jpg' %}"
                  width="31"
                  alt="Ryan Taylor"
              /></span>
            </a>
            <div class="dropdown-menu">
              <div class="user-header">
                <div class="avatar avatar-sm">
                  <img
                    src="{% static 'assets/img/profiles/avatar-18.jpg' %}"
                    alt="User Image"
                    class="avatar-img rounded-circle"
                  />
                </div>
                <div class="user-text">
                  <h6>{{user.username}}</h6>
                  <p class="text-muted mb-0">{% trans "Administrator" %}</p>
                </div>
              </div>
              <a class="dropdown-item" href="{% url 'logout' %}"
                >{% trans "Logout" %}</a
              >
            </div>
          </li>
        </ul>
      </div>
      <div class="sidebar" id="sidebar">
        <div class="sidebar-inner slimscroll">
          <div id="sidebar-menu" class="sidebar-menu">
            <ul>
              <li class="menu-title">
                <span>{% trans "Main Menu" %}</span>
              </li>
              <li class="submenu active">
                <a href="{% url 'dashboard' %}">
                  <i class="fas fa-user-graduate"></i>
                  <span>Trang chủ</span>
                </a>
              </li>

              {% if user.is_admin or user.is_teacher %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-user-graduate"></i>
                  <span> {% trans "Students" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="{% url 'student_list' %}"
                      >{% trans "Student List" %}</a
                    >
                  </li>
                  {% if user.is_admin %}
                  <li>
                    <a href="{% url 'add_student' %}"
                      >{% trans "Student Add" %}</a
                    >
                  </li>
                  {% endif %}
                </ul>
              </li>
              {% endif %} {% if user.is_admin or user.is_teacher %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-building"></i>
                  <span> {% trans "Classes" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="{% url 'class_list' %}"
                      >{% trans "Class List" %}</a
                    >
                  </li>
                  {% if user.is_admin %}
                  <li>
                    <a href="{% url 'add_class' %}">{% trans "Add Class" %}</a>
                  </li>
                  {% endif %}
                </ul>
              </li>
              {% endif %} {% if user.is_admin or user.is_teacher %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-book-reader"></i>
                  <span> {% trans "Subjects" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="{% url 'subject_list' %}"
                      >{% trans "Subject List" %}</a
                    >
                  </li>
                  {% if user.is_admin %}
                  <li>
                    <a href="{% url 'add_subject' %}"
                      >{% trans "Add Subject" %}</a
                    >
                  </li>
                  {% endif %}
                </ul>
              </li>
              {% endif %} {% if user.is_admin %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-chalkboard-teacher"></i>
                  <span> {% trans "Giáo viên" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="{% url 'teacher_list' %}"
                      >{% trans "Danh sách giáo viên" %}</a
                    >
                  </li>
                  <li>
                    <a href="{% url 'add_teacher' %}"
                      >{% trans "Thêm giáo viên" %}</a
                    >
                  </li>
                </ul>
              </li>
              {% endif %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-clipboard-list"></i>
                  <span> {% trans "Grades" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="{% url 'grade_list' %}"
                      >{% trans "Grade List" %}</a
                    >
                  </li>
                  {% if user.is_teacher or user.is_admin %}
                  <li>
                    <a href="{% url 'add_grade' %}">{% trans "Add Grade" %}</a>
                  </li>
                  {% endif %}
                </ul>
              </li>
              {% if user.is_admin or user.is_teacher %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-calendar-check"></i>
                  <span> {% trans "Attendance" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="{% url 'attendance_list' %}"
                      >{% trans "Attendance List" %}</a
                    >
                  </li>
                  {% if user.is_teacher or user.is_admin %}
                  <li>
                    <a href="{% url 'add_attendance' %}"
                      >{% trans "Add Attendance" %}</a
                    >
                  </li>
                  {% endif %}
                </ul>
              </li>
              {% endif %} {% if user.is_admin or user.is_teacher %}
              <li>
                <a href="{% url 'reports_dashboard' %}"
                  ><i class="fas fa-chart-bar"></i>
                  <span>{% trans "Reports" %}</span></a
                >
              </li>
              {% endif %}
              <li class="submenu">
                <a href="#"
                  ><i class="fas fa-shield-alt"></i>
                  <span> {% trans "Cài đặt tài khoản" %}</span>
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="{% url 'login' %}">{% trans "Login" %}</a></li>
                  <li>
                    <a href="{% url 'signup' %}">{% trans "Register" %}</a>
                  </li>
                  <li>
                    <a href="{% url 'forgot-password' %}"
                      >{% trans "Forgot Password" %}</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>

      {% block body %} {% endblock %}
    </div>

    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", function () {
        const notiDropdown = document.querySelector(".noti-dropdown");
        const clearAllBtn = document.querySelector(".clear-noti");

        if (notiDropdown) {
          notiDropdown.addEventListener("click", function () {
            const url = "{% url 'mark_notification_as_read' %}";

            fetch(url, {
              method: "POST",
              headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded",
              },
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {
                  const badge = document.querySelector(".badge");
                  if (badge) {
                    badge.remove();
                  }
                }
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          });
        }

        if (clearAllBtn) {
          clearAllBtn.addEventListener("click", function () {
            const clearUrl = "{% url 'clear_all_notification' %}";

            fetch(clearUrl, {
              method: "POST",
              headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded",
              },
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {

                  const notificationList =
                    document.querySelector(".notification-list");
                  if (notificationList) {
                    notificationList.innerHTML =
                      "<li>No new notifications</li>";
                  }
                }
              })
              .catch((error) => {
                console.error("Error:", error);
          });
        }
      });
    </script>
  </body>
</html>
