{% extends 'Home/base.html' %}
{% load static %}
{% load i18n %}
{% block body %}
   
         <div class="page-wrapper">
            <div class="content container-fluid">
               <div class="page-header">
                  <div class="row">
                     <div class="col-sm-12">
                        <h3 class="page-title">{% trans "Reports Dashboard" %}</h3>
                        <ul class="breadcrumb">
                           <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">{% trans "Dashboard" %}</a></li>
                           <li class="breadcrumb-item active">{% trans "Reports" %}</li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                     <div class="card bg-one w-100">
                        <div class="card-body">
                           <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                 <i class="fas fa-user-graduate"></i>
                              </div>
                              <div class="db-info">
                                 <h3>{{ total_students }}</h3>
                                 <h6>{% trans "Total Students" %}</h6>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                     <div class="card bg-two w-100">
                        <div class="card-body">
                           <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                 <i class="fas fa-building"></i>
                              </div>
                              <div class="db-info">
                                 <h3>{{ total_classes }}</h3>
                                 <h6>{% trans "Total Classes" %}</h6>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                     <div class="card bg-three w-100">
                        <div class="card-body">
                           <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                 <i class="fas fa-book-reader"></i>
                              </div>
                              <div class="db-info">
                                 <h3>{{ total_subjects }}</h3>
                                 <h6>{% trans "Total Subjects" %}</h6>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                     <div class="card bg-four w-100">
                        <div class="card-body">
                           <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                 <i class="fas fa-calendar-check"></i>
                              </div>
                              <div class="db-info">
                                 <h3>{{ attendance_rate }}%</h3>
                                 <h6>{% trans "Attendance Rate" %}</h6>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-md-12">
                     <div class="card">
                        <div class="card-header">
                           <h5 class="card-title">{% trans "Class Statistics" %}</h5>
                        </div>
                        <div class="card-body">
                           <div class="table-responsive">
                              <table class="table table-hover table-center">
                                 <thead>
                                    <tr>
                                       <th>STT</th>
                                       <th>Tên lớp</th>
                                       <th>Khối</th>
                                       <th>Học sinh</th>
                                       <th>Sĩ số tối đa</th>
                                       <th>Tỷ lệ đầy</th>
                                       <th>Điểm trung bình</th>
                                       <th>Giáo viên chủ nhiệm</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    {% for stat in class_stats %}
                                    <tr>
                                       <td>{{ forloop.counter }}</td>
                                       <td>{{ stat.class.class_name }}</td>
                                       <td>{{ stat.class.grade_level }}</td>
                                       <td>{{ stat.student_count }}</td>
                                       <td>{{ stat.capacity }}</td>
                                       <td>
                                          <div class="progress" style="width: 100px; height: 22px;">
                                             {% if stat.fill_rate >= 90 %}
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ stat.fill_rate }}%">{{ stat.fill_rate|floatformat:0 }}%</div>
                                             {% elif stat.fill_rate >= 70 %}
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: {{ stat.fill_rate }}%">{{ stat.fill_rate|floatformat:0 }}%</div>
                                             {% elif stat.fill_rate >= 50 %}
                                                <div class="progress-bar bg-info" role="progressbar" style="width: {{ stat.fill_rate }}%">{{ stat.fill_rate|floatformat:0 }}%</div>
                                             {% else %}
                                                <div class="progress-bar bg-success" role="progressbar" style="width: {{ stat.fill_rate }}%">{{ stat.fill_rate|floatformat:0 }}%</div>
                                             {% endif %}
                                          </div>
                                       </td>
                                       <td>
                                          {% if stat.average_grade %}
                                             <span class="badge badge-{% if stat.average_grade >= 8.0 %}success{% elif stat.average_grade >= 6.5 %}info{% elif stat.average_grade >= 5.0 %}warning{% else %}danger{% endif %}">
                                                {{ stat.average_grade|floatformat:2 }}
                                             </span>
                                          {% else %}
                                             <span class="text-muted">-</span>
                                          {% endif %}
                                       </td>
                                       <td>{% if stat.class.class_teacher %}{{ stat.class.class_teacher.get_full_name|default:stat.class.class_teacher.username }}{% else %}-{% endif %}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                       <td colspan="8" class="text-center">{% trans "No classes found" %}</td>
                                    </tr>
                                    {% endfor %}
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
{% endblock %}





